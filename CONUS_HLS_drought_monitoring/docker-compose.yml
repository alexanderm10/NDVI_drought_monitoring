version: '3.8'

services:
  drought-monitor-r:
    build: .
    container_name: conus-hls-drought-monitor
    user: "${UID:-1000}:${GID:-1000}"  # Match host user to avoid permission issues
    volumes:
      # Mount the entire project directory
      - .:/workspace
      # Mount persistent R library volume
      - r-libs:/home/rstudio/R/library
      # Mount data directory - adjust path for your Linux system
      # This path corresponds to U: drive on Windows via network mount
      - /mnt/malexander/datasets/ndvi_monitor:/data
    environment:
      # Set timezone
      - TZ=America/Denver
      # R environment variables
      - R_LIBS_USER=/home/rstudio/R/library
      # Optional: RStudio Server password
      - PASSWORD=rstudio
      # NASA Earthdata credentials (if needed for data downloads)
      # - NASA_USERNAME=your_username
      # - NASA_PASSWORD=your_password
    ports:
      # Optional: expose RStudio Server port
      - "8787:8787"
    working_dir: /workspace
    # Keep container running for VS Code attachment
    command: tail -f /dev/null
    # For VS Code integration
    stdin_open: true
    tty: true
    # Resource limits to prevent hogging shared resources
    deploy:
      resources:
        limits:
          cpus: '16.0'  # Limit to 16 CPU cores (adjust based on server capacity)
          memory: 64G   # GAM processing can be memory intensive
        reservations:
          cpus: '4.0'   # Reserve at least 4 cores
          memory: 16G   # Reserve at least 16GB

volumes:
  r-libs:
    driver: local
